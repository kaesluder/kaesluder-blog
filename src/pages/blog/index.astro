---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

// Get all blog posts and sort by date (newest first)
const allPosts = await getCollection("blog");
const sortedPosts = allPosts
	.filter((post) => !post.data.draft) // Filter out drafts
	.sort(
		(a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf(),
	);
console.log(`sorted posts: ${sortedPosts}`);
---

<BaseLayout title="Blog" description="All blog posts from Kae's personal blog">
	<h1>Blog Posts</h1>

	{
		sortedPosts.length === 0 ? (
			<p>No blog posts found.</p>
		) : (
			<ul>
				{sortedPosts.map((post) => (
					<li>
						<article>
							<h2>
								<a href={`/blog/${post.id}/`}>{post.data.title}</a>
							</h2>
							<time datetime={post.data.date.toISOString()}>
								{post.data.date.toLocaleDateString("en-US", {
									year: "numeric",
									month: "long",
									day: "numeric",
								})}
							</time>
							{post.data.tags && post.data.tags.length > 0 && (
								<div>
									Tags:{" "}
									{post.data.tags.map((tag, index) => (
										<span>
											{tag}
											{index < post.data.tags.length - 1 ? ", " : ""}
										</span>
									))}
								</div>
							)}
						</article>
					</li>
				))}
			</ul>
		)
	}
</BaseLayout>
